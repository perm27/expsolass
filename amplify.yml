version: 1
frontend:
  phases:
    # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å«ã‚€ï¼‰ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
    preBuild:
      commands:
        # ãƒ«ãƒ¼ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        - npm install

        # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ/å–å¾—ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
        # - amplify pull --appId YOUR_APP_ID --env YOUR_ENV_NAME --amplify-outputs-path .
        # AWSèªè¨¼æƒ…å ±ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ä½¿ç”¨ã—ã€éå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
        - |
          amplify pull \
            --appId AMPLIFY_APP_ID \
            --envName prod \
            --amplify-outputs-path . \
            --yes
            
        #   --aws-config '{"accessKeyId": "'"$AWS_ACCESS_KEY_ID"'", "secretAccessKey": "'"$AWS_SECRET_ACCESS_KEY"'", "region": "'"$AWS_REGION"'"}'
            
        # ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® src ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
        - cp ./amplify_outputs.json ./frontend/src/

        # frontend ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã€ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€å¿…è¦ãªãƒã‚¤ãƒŠãƒªãŒæƒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        - cd frontend
        - npm install
        - cd ..
    build:
      commands:
        # PATHã«ãƒ­ãƒ¼ã‚«ãƒ«ã®node_modulesãƒã‚¤ãƒŠãƒªã®ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã€`react-scripts` ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        - export PATH=$PATH:./node_modules/.bin
        - export PATH=$PATH:./frontend/node_modules/.bin
        # frontend ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
        - cd frontend
        - npm run build
  # ğŸ’¡ æˆæœç‰©(é™çš„ãƒ•ã‚¡ã‚¤ãƒ«)ãŒ frontend/build/ ã«ã‚ã‚‹ã“ã¨ã‚’æŒ‡å®š
  artifacts:
    baseDirectory: frontend/build 
    files:
      - '**/*'
  # ğŸ’¡ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’ frontend/ ã«æŒ‡å®š (ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
  baseDirectory: frontend 

